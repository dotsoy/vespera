# 🔬 Marimo研究室使用指南

## 📋 功能概述

**Marimo研究室**是集成在启明星仪表盘中的交互式数据科学笔记本环境，专门用于深度股票分析和策略研究。

### 🎯 核心特性
- **一键启动**: 从Streamlit界面直接启动Marimo笔记本
- **多笔记本管理**: 同时运行多个研究笔记本
- **模板丰富**: 预置策略回测、个股分析等模板
- **无缝集成**: 生产环境与研究环境完美融合

## 🚀 快速开始

### 1. 启动仪表盘
```bash
make dashboard
```
或
```bash
streamlit run dashboard/app.py
```

### 2. 访问研究室
1. 打开浏览器访问 `http://localhost:8501`
2. 在左侧边栏找到 **🔬 Marimo 研究室**
3. 点击笔记本旁的 🚀 按钮启动

### 3. 开始研究
- 笔记本将在新端口启动（通常是8081-8090）
- 点击 🌐 按钮在新标签页打开
- 开始您的交互式数据分析

## 📚 预置笔记本

### 1. 策略回测模板 (`strategy_backtest_template.py`)
**用途**: 测试和验证交易策略

**功能特点**:
- 📊 交互式参数调整
- 📈 实时策略信号生成
- 💰 完整回测结果分析
- 🎯 风险收益评估

**适用场景**:
- 新策略验证
- 参数优化
- 历史回测
- 策略对比

### 2. 个股深度分析 (`specific_stock_deep_dive.py`)
**用途**: 单只股票的全面分析

**功能特点**:
- 📈 技术分析图表
- 💰 基本面指标评估
- 🎯 综合投资建议
- 📊 多维度评分

**适用场景**:
- 个股研究
- 投资决策
- 风险评估
- 价值发现

### 3. 市场情绪分析 (`market_sentiment_analysis.py`)
**用途**: 市场整体情绪和投资者行为分析

**功能特点**:
- 😊 恐慌贪婪指数
- 📊 市场广度分析
- 💰 资金流向追踪
- 🎯 情绪交易信号

**适用场景**:
- 市场择时
- 情绪指标研究
- 逆向投资
- 市场节奏把握

## 🔧 管理功能

### 笔记本管理
- **📚 管理**: 点击侧边栏的"管理"按钮
- **✏️ 编辑**: 在管理面板中编辑笔记本
- **🗑️ 删除**: 删除不需要的笔记本
- **📁 目录**: 直接访问笔记本目录

### 运行状态监控
- **🏃 运行中**: 查看当前运行的笔记本
- **⏹️ 停止**: 停止不需要的笔记本
- **🔄 重启**: 重启有问题的笔记本
- **📊 状态**: 监控运行时间和端口

### 快速创建
- **➕ 模板选择**: 从预定义模板创建
- **📝 自定义名称**: 为笔记本命名
- **🚀 创建并启动**: 一键创建并启动

## 💡 使用技巧

### 1. 端口管理
- 系统自动分配端口（8081-8090）
- 避免端口冲突
- 支持多笔记本同时运行

### 2. 数据共享
- 笔记本可以访问项目数据
- 共享分析结果
- 导入自定义模块

### 3. 性能优化
- 及时停止不用的笔记本
- 避免同时运行过多实例
- 定期清理临时文件

## 🎨 自定义笔记本

### 创建新笔记本
1. 在研究室中点击"快速创建"
2. 选择合适的模板
3. 输入笔记本名称
4. 点击"创建并启动"

### 笔记本结构
```python
"""
笔记本描述
"""
import marimo as mo
import pandas as pd
import numpy as np

def __():
    mo.md("""
    # 笔记本标题
    
    描述您的分析内容
    """)

def __():
    # 您的分析代码
    pass

if __name__ == "__main__":
    mo.run()
```

### 最佳实践
- **模块化设计**: 将分析分解为独立的函数
- **交互式控件**: 使用`mo.ui`创建参数控制
- **可视化**: 使用Plotly创建交互式图表
- **文档化**: 用Markdown详细说明分析逻辑

## 🔗 与主系统集成

### 数据访问
```python
# 访问项目数据
import sys
from pathlib import Path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

# 导入项目模块
from src.utils.database import get_db_manager
from src.analysis.technical_analyzer import TechnicalAnalyzer
```

### 结果共享
- 分析结果可保存到项目目录
- 与主仪表盘数据同步
- 支持导出和导入

## ⚠️ 注意事项

### 系统要求
- **Marimo**: 需要安装`pip install marimo`
- **端口**: 确保8081-8090端口可用
- **内存**: 建议至少4GB可用内存

### 安全提醒
- 笔记本运行在本地环境
- 注意数据隐私保护
- 定期备份重要分析

### 性能建议
- 避免在笔记本中处理超大数据集
- 使用采样数据进行快速验证
- 复杂计算考虑使用缓存

## 🛠️ 故障排除

### 常见问题

#### 1. Marimo未安装
**症状**: 提示"Marimo未安装"
**解决**: 运行`pip install marimo`

#### 2. 端口被占用
**症状**: 启动失败，端口冲突
**解决**: 系统会自动寻找可用端口

#### 3. 笔记本无法访问
**症状**: 点击链接无法打开
**解决**: 检查防火墙设置，确保端口开放

#### 4. 进程卡死
**症状**: 笔记本无响应
**解决**: 在管理面板中重启笔记本

### 调试方法
1. 查看控制台日志
2. 检查端口占用情况
3. 重启Streamlit应用
4. 清理临时文件

## 📈 高级用法

### 1. 策略组合分析
```python
# 多策略对比
strategies = ['MA', 'RSI', 'MACD']
for strategy in strategies:
    # 分析每个策略
    pass
```

### 2. 实时数据分析
```python
# 连接实时数据源
from src.data_sources.data_source_factory import get_data_service
data_service = get_data_service()
```

### 3. 机器学习集成
```python
# 使用机器学习模型
from sklearn.ensemble import RandomForestClassifier
model = RandomForestClassifier()
```

## 🎯 应用场景

### 研究场景
- **策略开发**: 新策略的设计和验证
- **因子挖掘**: 寻找有效的量化因子
- **风险建模**: 构建风险评估模型
- **市场研究**: 深度市场分析

### 教学场景
- **量化教学**: 交互式量化金融教学
- **案例分析**: 实际案例的深度剖析
- **技能培训**: 数据分析技能训练

### 生产场景
- **策略验证**: 上线前的最后验证
- **参数调优**: 实时参数优化
- **异常诊断**: 策略异常的快速诊断

## 🚀 未来规划

### 短期目标
- [ ] 更多预置模板
- [ ] 数据源直连
- [ ] 结果自动同步
- [ ] 性能监控

### 中期目标
- [ ] 云端部署支持
- [ ] 协作功能
- [ ] 版本控制
- [ ] 自动化测试

### 长期目标
- [ ] AI辅助分析
- [ ] 智能推荐
- [ ] 社区分享
- [ ] 企业级功能

---

**🎊 Marimo研究室让您的量化研究更加高效、直观、有趣！**

*最后更新: 2025年6月15日*
